// Prisma schema for Jewelry Store Management System
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Company {
  id        Int      @id @default(autoincrement())
  companyName String  @db.VarChar(255)
  slogan    String?  @db.VarChar(500)
  phone     String   @db.VarChar(50)
  email     String?  @db.VarChar(255)
  address   String   @db.VarChar(500)
  date      DateTime?
  image     String?  @db.VarChar(500)

  @@map("companies")
}

model Product {
  id                Int      @id @default(autoincrement())
  productName       String   @db.VarChar(255)
  type              String   @db.VarChar(100)
  gram              Float
  karat             Float
  purchasePriceToAfn Float
  bellNumber        Int?
  isSold            Boolean  @default(false)
  image             String?  @db.VarChar(500)
  barcode           String   @unique @db.VarChar(100)
  wage              Float?
  auns              Float?
  isFragment        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("products")
  @@index([isSold])
  @@index([barcode])
}

model Customer {
  id          Int      @id @default(autoincrement())
  customerName String   @db.VarChar(255)
  phone       String   @db.VarChar(50)
  email       String?  @db.VarChar(255)
  address     String?  @db.VarChar(500)
  date        DateTime @default(now())

  transactions Transaction[]
  loanReports  LoanReport[]

  @@map("customers")
  @@index([phone])
}

model Transaction {
  id            Int      @id @default(autoincrement())
  customerId    Int
  customerName  String   @db.VarChar(255)
  customerPhone String   @db.VarChar(50)
  product       Json     // Array of products
  receipt       Json     // Receipt object
  bellNumber    Int      @unique
  note          String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  customer      Customer @relation(fields: [customerId], references: [id])

  @@map("transactions")
  @@index([bellNumber])
  @@index([customerId])
}

model Supplier {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  phone     String   @db.VarChar(50)
  address   String?  @db.VarChar(500)
  isActive  Boolean  @default(true)

  purchases        Purchase[]
  supplierProducts SupplierProduct[]
  receiptPasa      ReceiptPasa[]

  @@map("suppliers")
  @@index([phone])
}

model ProductMaster {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  type      String   @db.VarChar(100)
  gram      Float
  karat     Float
  isActive  Boolean  @default(true)

  purchaseItems PurchaseItem[]

  @@map("product_masters")
}

model PMaster {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  type      String   @db.VarChar(100)
  gram      Float
  karat     Float
  isActive  Boolean  @default(true)

  @@map("p_masters")
}

model PurchaseItem {
  id            Int      @id @default(autoincrement())
  purchaseId    Int
  productMasterId Int
  name          String   @db.VarChar(255)
  type          String   @db.VarChar(100)
  gram          Float
  karat         Float
  quantity      Int
  registeredQty Int     @default(0)
  remainingQty  Int
  price         Float
  isCompleted   Boolean  @default(false)

  purchase      Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  productMaster ProductMaster @relation(fields: [productMasterId], references: [id])

  @@map("purchase_items")
  @@index([purchaseId])
}

model Purchase {
  id          Int      @id @default(autoincrement())
  supplierId  Int
  supplierName String  @db.VarChar(255)
  totalAmount Float?
  date        DateTime @default(now())
  bellNumber  Int      @unique
  currency    String   @db.VarChar(50)
  paidAmount  Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  supplier    Supplier @relation(fields: [supplierId], references: [id])
  items       PurchaseItem[]

  @@map("purchases")
  @@index([bellNumber])
  @@index([supplierId])
}

model Trader {
  id      Int      @id @default(autoincrement())
  name    String   @db.VarChar(255)
  phone   String   @db.VarChar(50)
  address String?  @db.VarChar(500)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trades  Trade[]

  @@map("traders")
  @@index([phone])
}

model Trade {
  id        Int      @id @default(autoincrement())
  traderId  Int
  traderName String  @db.VarChar(255)
  amount    Float
  type      String   @db.VarChar(100)
  detail    String?  @db.Text
  currency  String   @db.VarChar(50)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trader    Trader   @relation(fields: [traderId], references: [id])

  @@map("trades")
  @@index([traderId])
}

model Fragment {
  id          Int      @id @default(autoincrement())
  gram        Float
  wareHouse   Float    @default(0)
  changedToPasa Float  @default(0)
  remain      Float?
  amount      Float
  detail      String?  @db.Text
  date        DateTime @default(now())
  isCompleted Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("fragments")
}

model Expenses {
  id      Int      @id @default(autoincrement())
  type    String   @db.VarChar(100)
  detail  String   @db.VarChar(500)
  price   Float
  currency String  @db.VarChar(50) // ENUM: 'دالر' or 'افغانی'
  date    DateTime @default(now())

  @@map("expenses")
  @@index([date])
}

model CurrencyRate {
  id      Int      @id @default(autoincrement())
  date    String   @unique @db.VarChar(50) // Format: YYYY-MM-DD
  usdToAfn Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("currency_rates")
  @@index([date])
}

model LoanReport {
  id        Int      @id @default(autoincrement())
  cName     String   @db.VarChar(255)
  cId       Int
  amount    Float
  currency  String   @db.VarChar(50)
  detail    String   @db.VarChar(500)
  date      DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  customer  Customer @relation(fields: [cId], references: [id])

  @@map("loan_reports")
  @@index([cId])
}

model Person {
  id    Int      @id @default(autoincrement())
  name  String   @db.VarChar(255)
  phone String   @db.VarChar(50)

  personalExpenses PersonalExpense[]

  @@map("persons")
  @@index([phone])
}

model PersonalExpense {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  personId  Int
  amount    Float
  currency  String   @db.VarChar(50)
  detail    String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  person    Person   @relation(fields: [personId], references: [id])

  @@map("personal_expenses")
  @@index([personId])
}

model Storage {
  id        Int      @id @default(autoincrement())
  date      String   @unique @db.VarChar(50) // Format: YYYY-MM-DD
  usd       Float
  afn       Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("storages")
  @@index([date])
}

model SupplierProduct {
  id            Int      @id @default(autoincrement())
  supplierId    Int
  supplierName  String   @db.VarChar(255)
  name          String   @db.VarChar(255)
  type          String?  @db.VarChar(100)
  karat         Float?
  weight        Float
  registeredWeight Float  @default(0)
  remainWeight  Float?
  pasa          Float
  pasaReceipt   Float    @default(0)
  pasaRemaining Float
  wagePerGram   Float?
  totalWage     Float
  wageReceipt   Float    @default(0)
  wageRemaining Float
  bellNumber    Int?
  detail        String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  supplier      Supplier @relation(fields: [supplierId], references: [id])

  @@map("supplier_products")
  @@index([supplierId])
}

model Pasa {
  id      Int      @id @default(autoincrement())
  gram    Float
  toPasa  Float
  detail  String?  @db.Text
  date    DateTime?

  @@map("pasas")
}

model ReceiptPasa {
  id          Int      @id @default(autoincrement())
  supplierId  Int
  supplierName String  @db.VarChar(255)
  receiptPasa Float    @default(0)
  receiptWage Float    @default(0)
  detail      String?  @db.Text
  date        DateTime?

  supplier    Supplier @relation(fields: [supplierId], references: [id])

  @@map("receipt_pasas")
  @@index([supplierId])
}

model FragmentReport {
  id          Int      @id @default(autoincrement())
  totalGram   Float
  totalAmount Float
  toWareHouse Float    @default(0)
  toPasa      Float    @default(0)
  detail      String   @db.VarChar(500)
  date        DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("fragment_reports")
}
